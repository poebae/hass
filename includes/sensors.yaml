- platform: command_line
  name: SSL cert expiry
  unit_of_measurement: days
  scan_interval: 10800
  command: "ssl-cert-check -b -c /etc/letsencrypt/live/poebae.duckdns.org/cert.pem | awk '{ print $NF }'"


# HA Uptime
- platform: uptime
  name: "HA uptime"
  unit_of_measurement: minutes

- platform: aftership
  api_key: !secret aftership_key

# Weather
- platform: darksky
  api_key: !secret darksky_key
  language: it
  forecast:
    - 0
    - 1
    - 2
    - 3
    - 4
    - 5
  monitored_conditions:
    - icon
    - summary
    - nearest_storm_distance
    - nearest_storm_bearing
    - humidity
    - temperature
    - temperature_high
    - temperature_low
    - apparent_temperature
    - apparent_temperature_high
    - apparent_temperature_low
    - wind_speed
    - wind_bearing
    - precip_type
    - precip_probability
    - precip_accumulation
    - precip_intensity
    - precip_intensity_max
    - uv_index
    - daily_summary
    - pressure
    - visibility
  scan_interval:
    minutes: 5

# Transit
- platform: google_travel_time
  name: Drive to ATA
  api_key: !secret google_api
  origin: zone.home
  destination: 1 Fitzwilliam St, Parramatta
  options:
    mode: driving

# System Monitor
- platform: systemmonitor
  resources:
  - type: disk_use_percent
    arg: /
  - type: memory_free
  - type: processor_use
  - type: network_in
    arg: enp7s0
  - type: network_out
    arg: enp7s0
  - type: last_boot

# Pihole
- platform: pi_hole
  host: 192.168.1.69
  monitored_conditions:
    - ads_blocked_today
    - ads_percentage_today
    - dns_queries_today
    - domains_being_blocked
    - queries_cached
    - queries_forwarded
    - unique_clients
    - unique_domains

# Steam
- platform: steam_online
  api_key: !secret steamkey
  accounts:
    - 76561198051415178
    - 76561198302985542
    - 76561198053059377
    - 76561198017280281
    - 76561197982549749
    - 76561198078583977
# Suntory    - 76561198268190094

# Current Steam game  
- platform: template
  sensors:
    steam_game_calmdown:
      friendly_name: "Game"
      value_template: "{{ states.sensor.steam_76561198302985542.attributes.game }}"

- platform: template
  sensors:
    steam_game_jono:
      friendly_name: "Game"
      value_template: "{{ states.sensor.steam_76561197982549749.attributes.game }}"

- platform: template
  sensors:
    steam_game_mike:
      friendly_name: "Game"
      value_template: "{{ states.sensor.steam_76561198017280281.attributes.game }}"

- platform: template
  sensors:
    steam_game_graham:
      friendly_name: "Game"
      value_template: "{{ states.sensor.steam_76561198051415178.attributes.game }}"

- platform: template
  sensors:
    steam_game_ww:
      friendly_name: "Game"
      value_template: "{{ states.sensor.steam_76561198053059377.attributes.game }}"

- platform: template
  sensors:
    steam_game_willy:
      friendly_name: "Game"
      value_template: "{{ states.sensor.steam_76561198078583977.attributes.game }}"

# In game?
- platform: template
  sensors:
    ingame:
      friendly_name: "In Game?"
      value_template: >-
        {% if is_state('sensor.steam_game_calmdown', '') %}
          no
        {% endif %}

########################################################################################################################
#                                                 TEMPLATE SENSORS                                                     #
########################################################################################################################

# Aftership
    aftership_pending:
      value_template: '{{ states.sensor.aftership.attributes.pending }}'
      friendly_name: 'Pending'
    aftership_intransit:
      value_template: '{{ states.sensor.aftership.attributes.intransit }}'
      friendly_name: 'In Transit'
    aftership_delivered:
      value_template: '{{ states.sensor.aftership.attributes.delivered }}'
      friendly_name: 'Delivered'

# Sun
    time_sunrise:
      value_template: '{{ as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom("%H:%M") }}'
    time_sunset:
      value_template: '{{ as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom("%H:%M") }}'
    time_next_dawn:
      value_template: '{{ as_timestamp(states.sun.sun.attributes.next_dawn) | timestamp_custom("%H:%M") }}'
    time_next_dusk:
      value_template: '{{ as_timestamp(states.sun.sun.attributes.next_dusk) | timestamp_custom("%H:%M") }}'
    time_sun_elevation:
      value_template: '{{ states.sun.sun.attributes.elevation }}'
    time_sun_azimuth:
      value_template: '{{ states.sun.sun.attributes.azimuth }}'

# Batteries
    graham_battery:
      value_template: '{{ states.device_tracker.pixel3_2_2.attributes.battery_level | round(0) }}'
      friendly_name: 'Graham Pixel 3 Battery'
      unit_of_measurement: '%'
      icon_template: >
       {% set battery_level = states.device_tracker.pixel3_2_2.attributes.battery_level|default(0)|int %}
       {% set battery_round = (battery_level / 10) |int * 10 %}
       {% if battery_round >= 100 %}
         mdi:battery
        {% elif battery_round > 0 %}
         mdi:battery-{{ battery_round }}
       {% else %}
         mdi:battery-alert
       {% endif %}

    bora_battery:
      value_template: '{{ states.device_tracker.galaxys8_2_2.attributes.battery_level | round(0) }}'
      friendly_name: 'Bora Galaxy S8 Battery'
      unit_of_measurement: '%'
      icon_template: >
       {% set battery_level = states.device_tracker.galaxys8_2_2.attributes.battery_level|default(0)|int %}
       {% set battery_round = (battery_level / 10) |int * 10 %}
       {% if battery_round >= 100 %}
         mdi:battery
        {% elif battery_round > 0 %}
         mdi:battery-{{ battery_round }}
       {% else %}
         mdi:battery-alert
       {% endif %}

# Template for Floorplan
    bedroom_door_closed:
      entity_id: binary_sensor.door_bedroom
      value_template: >
        {% if is_state('binary_sensor.door_bedroom', 'off') %}
          on
        {% else %}
          off
        {% endif %}

    study_motion:
      entity_id: binary_sensor.motion_study
      value_template: >
        {% if is_state('binary_sensor.motion_study_occupancy', 'on') %}
          on
        {% else %}
          off
        {% endif %}

    kitchen_motion:
      entity_id: binary_sensor.motion_kitchen
      value_template: >
        {% if is_state('binary_sensor.motion_kitchen', 'on') %}
          on
        {% else %}
          off
        {% endif %}

    livingroom_motion:
      entity_id: binary_sensor.motion_living
      value_template: >
        {% if is_state('binary_sensor.motion_living', 'on') %}
          on
        {% else %}
          off
        {% endif %}

- platform: mqtt
  state_topic: 'monitor/ha-monitor/3c:28:6d:2b:f1:cd'
  value_template: '{{ value_json.confidence }}'
  unit_of_measurement: '%'
  name: 'Graham Pixel Bluetooth'

- platform: mqtt
  state_topic: 'monitor/ha-monitor/c8:d7:b0:ad:51:1f'
  value_template: '{{ value_json.confidence }}'
  unit_of_measurement: '%'
  name: 'Bora S8 Bluetooth'
